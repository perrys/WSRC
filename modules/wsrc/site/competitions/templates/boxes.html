{% extends "06_wsrc_navigation.html" %}

{% block pagetitle %}{{ competition.name }}{% endblock %}
{% block pagetype %}boxes{% endblock %}
{% load competitions_extras %}
{% block pageattrs %}data-competitiongroupid="{{ competition.id }}"{% endblock %}
{% block html_header_extra %}
{{ block.super }}
<script>
window.WSRC_box_data = {{ box_data|safe }};
</script>
{% endblock %}
{% block centered_page_content %}

  <form id="page-control-form" method="GET" action="#" onsubmit="return false;" >  
    <div class="left-control-box">
      <select name="league_end_date" id="league_end_date" onchange="WSRC.onLeagueSelected(this)">
        <option value="" >Leagues Ending . . .</option>
{% regroup leagues|dictsortreversed:'year' by year as yearly_leagues_list %}
{% for yearly_leagues in yearly_leagues_list %}
        <optgroup label="{{ yearly_leagues.grouper }}">
{% for league in yearly_leagues.list|dictsortreversed:'end_date' %}
          <option value="{{ league.end_date|date:'Y-m-d' }}">{{ league.name }}</option>
{% endfor %}
        </optgroup>
{% endfor %}
      </select>
    </div>
    <div class="right-control-box">
      <fieldset data-role="controlgroup" data-type="horizontal" data-shadow="true">
        <input type="radio" name="view_type" id="view_type_boxes" value="boxes" checked="checked" />
        <label for="view_type_boxes">Boxes</label>
        <input type="radio" name="view_type" id="view_type_tables" value="tables" />
        <label for="view_type_tables">Tables</label>
      </fieldset>
      <fieldset data-role="controlgroup" data-type="horizontal" data-shadow="true">
        <button id="box-refresh-button" data-inline="true" class="ui-btn ui-icon-refresh ui-btn-icon-right">Refresh</button>
      </fieldset>
    </div>
    <div class="clear-all"></div>
  </form>

  <div class="competition-wrapper">
{% for box_config in boxes %}
<!-- {{ box_config.colspec }} {{ box_config.nthcol }} -->
{% if box_config.colspec != 'double' or box_config.nthcol != 'second' %}
  <div class="ui-grid-a boxes-wrapper boxes-wrapper-{{ box_config.colspec }}column">
{% endif %}
    <div class="ui-corner-all custom-corners boxes {% if box_config.colspec == 'double' %}boxes-{{ box_config.nthcol }}column ui-block-{% if box_config.nthcol == 'first' %}a{% else %}b{% endif %}{% endif %}">
      <div class="ui-bar ui-bar-b box-header" data-role="header" data-theme="b">
        <h2>{% if user.is_authenticated %}<a href="{% url 'member_list' %}?filter-ids={% for p in box_config.players %}{% if p.id %}{% if forloop.counter0 > 0 %},{% endif %}{{ p.id }}{% endif %}{% endfor %}">{% endif %}{{ box_config.name }}{% if user.is_authenticated %}</a>{% endif %}</h2>
{% if user.is_authenticated %}
<!--
        <a id="link-{{ box_config.id }}" href="#boxDetailDialog" data-rel="popup" data-position-to="window" data-transition="pop" class="ui-btn ui-icon-edit ui-btn-icon-notext ui-corner-all ui-btn-right" onclick="WSRC.onBoxActionClicked(this); return true;">
        </a>
-->
{% endif %}
      </div>
      <div class="ui-body ui-body-a">
        <table data-role="table" data-mode="" id="table-{{ box_config.id }}" class="boxes ui-corner-all ui-table boxtable">
          <thead>
            <tr>
              <th colspan="2"></th>
{% for i in competition.maxplayers|as_range %}<td class="ui-bar-a">{{ i|add:"1" }}</td>{% endfor %}
              <td class="ui-bar-a">Î£</td>
            </tr>
          </thead>
          <tbody>
{% for i in competition.maxplayers|as_range %}
{% resolve box_config.players i as player %}
            <tr {% if player.id %}id="player-{{ player.id }}"{% endif %}>
              <th {% if user.is_authenticated and user.player.id == player.id %}class="wsrc-currentuser"{% endif %}>{% if user.is_authenticated %}<a href="{% url 'member_list' %}?filter-ids={{ player.id }}">{% endif %}{{ player.get_full_name }}{% if user.is_authenticated %}</a>{% endif %}</th>
              <td class="ui-bar-a">{{ i|add:"1" }}</td>
{% for j in competition.maxplayers|as_range %}
              <td class="{% if i == j %}ui-bar-a{% else %}points{% endif %}"> </td>
{% endfor %}
              <td class="points score_total"> </td>
            </tr>
{% endfor %}
          </tbody>
        </table>
        <table data-role="table" data-mode="" id="leaguetable-{{ box_config.id }}" class="boxes ui-corner-all leaguetable" style="display: none">
	<thead>
	  <tr>
	    <th data-priority="persist" class=""></th>
	    <td data-priority="2" class="ui-bar-a">P</td>
	    <td data-priority="3" class="ui-bar-a">W</td>
	    <td data-priority="4" class="ui-bar-a">D</td>
	    <td data-priority="5" class="ui-bar-a">L</td>
	    <td data-priority="4" class="ui-bar-a">F</td>
	    <td data-priority="5" class="ui-bar-a">A</td>
	    <td data-priority="5" class="ui-bar-a" style="max-width: 1em;">Pts</td>
	  </tr>
	</thead>
        <tbody>
{% for i in competition.maxplayers|as_range %}
{% resolve box_config.players i as player %}
          <tr {% if player.id %}id="leaguetable-player-{{ player.id }}"{% endif %}>
            <th>{% if user.is_authenticated %}<a href="{% url 'member_list' %}?filter-ids={{ player.id }}">{% endif %}{{ player.get_full_name }}{% if user.is_authenticated %}</a>{% endif %}</th>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
            <td class="points score_total"> </td>
          </tr>
{% endfor %}
        </tbody>
        </table>

      </div>
    </div>
{% if box_config.colspec != 'double' or box_config.nthcol != 'first' %}
  </div>
{% endif %}
{% endfor %}
  </div>
{% endblock %}{% comment "centered_page_content" %}{% endcomment %}

{% block extra_page_content %}
{{ block.super }}
<div data-role="popup" id="boxDetailDialog" data-overlay-theme="b" data-theme="a" data-dismissible="true">
  <div data-role="header" data-theme="a">
    <h2> </h2>
    <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
  </div>
  <div class="ui-content">
    <div data-role="collapsibleset" data-theme="a" data-content-theme="a">
      <div data-role="collapsible" data-collapsed="true" data-iconpos="right" id="add-change-div">
        <h4>Match Result</h4>

{% include "match_result_form.html" %}

      </div>
      <div data-role="collapsible" data-collapsed="true" data-iconpos="right" id="league-results-div">
        <h4>All Results</h4>
        <div>&nbsp;</div>
        <p></p>
      </div>

    </div>
  </div>
</div>
{% endblock %}{% comment "extra_page_content" %}{% endcomment %}
