{% extends "06_wsrc_navigation.html" %}

{% block pagetitle %}{{ competition.name }}{% endblock %}
{% block pagetype %}boxes{% endblock %}
{% load competitions_extras %}
{% block html_header_extra %}
{{ block.super }}
<script>
window.WSRC_players  = { {% for p in players %}{% if forloop.counter0 > 0 %},{% endif %}{{ p.id }}: {id: {{ p.id }}, full_name: "{{ p.user__first_name }} {{ p.user__last_name }}"}{% endfor %} };
window.WSRC_box_data = {{ box_data|safe }};
</script>
{% endblock %}
{% block centered_page_content %}

  <form id="page-control-form" method="GET" action="#" onsubmit="return false;" >  
    <div class="left-control-box">
      <select name="league_end_date" id="league_end_date" onchange="wsrc.boxes.on('handle_league_changed', this)">
        <option value="" >{{ selector.default_text }} . . .</option>
{% regroup selector.links|dictsortreversed:'year' by year as yearly_links_list %}
{% for yearly_links in yearly_links_list %}
        <optgroup label="{{ yearly_links.grouper }}">
{% for link in yearly_links.list|dictsortreversed:'end_date' %}
          <option value="{{ link.link }}" {% if link.selected %}selected="selected"{% endif %}>{{ link.name }}</option>
{% endfor %}
        </optgroup>
{% endfor %}
      </select>
    </div>
    <div class="right-control-box">
      <fieldset data-role="controlgroup" data-type="horizontal" data-shadow="true" data-theme="c">
        <input type="radio" name="view_type" id="view_type_boxes" value="boxes" checked="checked" />
        <label for="view_type_boxes">Boxes</label>
        <input type="radio" name="view_type" id="view_type_tables" value="tables" />
        <label for="view_type_tables">Tables</label>
      </fieldset>
      <fieldset data-role="controlgroup" data-type="horizontal" data-shadow="true">
        <button id="box-refresh-button" data-inline="true" class="ui-btn ui-icon-refresh ui-btn-icon-left">Refresh</button>
      </fieldset>
    </div>
    <div class="clear-all"></div>
  </form>

  <div id="source_boxes" oclass="competition-wrapper">
{% for box_config in boxes %}
<!-- {{ box_config.colspec }} {{ box_config.nthcol }} -->
{% if box_config.colspec != 'double' or box_config.nthcol != 'second' %}
  <div class="ui-grid-a boxes-wrapper boxes-wrapper-{{ box_config.colspec }}column">
{% endif %}
    <div class="ui-corner-all custom-corners boxes {% if box_config.colspec == 'double' %}boxes-{{ box_config.nthcol }}column ui-block-{% if box_config.nthcol == 'first' %}a{% else %}b{% endif %}{% endif %}">
      <div class="ui-bar box-header" data-theme="b" data-role="header">
        <h2>{% if user.is_authenticated %}<a href="{% url 'member_list' %}?filter-ids={% for e in box_config.entrants %}{% if e.player1.id %}{% if forloop.counter0 > 0 %},{% endif %}{{ e.player1.id }}{% endif %}{% endfor %}">{% endif %}{{ box_config.name }}{% if user.is_authenticated %}</a>{% endif %}</h2>
{% if box_config.can_edit %}
        <a id="link-{{ box_config.id }}" class="ui-btn ui-btn-icon ui-btn-icon-left ui-icon-edit ui-corner-all ui-btn-right ui-btn-a" onclick="wsrc.boxes.on('handle_edit_clicked', {{ box_config.id }}); return true;">Edit
        </a>
{% endif %}
        <a class="ui-btn ui-btn-icon ui-btn-icon-left ui-icon-bullets ui-corner-all ui-btn-left ui-btn-a" data-rel="popup" onclick="wsrc.boxes.on('handle_results_clicked', {{ box_config.id }}); return true;">Results</a>
      </div>
      <div class="ui-body ui-body-a">
        <table data-role="table" data-mode="" data-name="{{ box_config.name }}" data-id="{{ box_config.id }}" class="boxes ui-corner-all ui-table boxtable">
          <thead>
            <tr>
              <th colspan="2"></th>
{% for i in competition.maxplayers|as_range %}<td class="ui-bar-b">{{ i|add:"1" }}</td>{% endfor %}
              <td class="ui-bar-b">Î£</td>
            </tr>
          </thead>
          <tbody>
{% for i in competition.maxplayers|as_range %}
{% resolve box_config.entrants i as entrant %}
            <tr data-id="{{ entrant.id }}">
              <th {% if user.is_authenticated and user.player.id == entrant.player1.id %}class="wsrc-currentuser"{% endif %}>{% if user.is_authenticated %}<a href="{% url 'member_list' %}?filter-ids={{ entrant.player1.id }}">{% endif %}{{ entrant.player1.user.get_full_name }}{% if entrant.handicap != None %} ({{ entrant.handicap }}){% endif %}{% if user.is_authenticated %}</a>{% endif %}</th>
              <td class="ui-bar-b">{{ i|add:"1" }}</td>
{% for j in competition.maxplayers|as_range %}
              <td class="{% if i == j %}ui-bar-b{% else %}points{% endif %}"> </td>
{% endfor %}
              <td class="points score_total"> </td>
            </tr>
{% endfor %}
          </tbody>
        </table>
        <table data-role="table" data-mode="" data-name="{{ box_config.name }}" data-id="{{ box_config.id }}" class="boxes ui-corner-all leaguetable" style="display: none">
	<thead>
	  <tr>
	    <th data-priority="persist" class=""></th>
	    <td data-priority="2" class="ui-bar-b">P</td>
	    <td data-priority="3" class="ui-bar-b">W</td>
	    <td data-priority="4" class="ui-bar-b">D</td>
	    <td data-priority="5" class="ui-bar-b">L</td>
	    <td data-priority="4" class="ui-bar-b">F</td>
	    <td data-priority="5" class="ui-bar-b">A</td>
	    <td data-priority="5" class="ui-bar-b" style="max-width: 1em;">Pts</td>
	  </tr>
	</thead>
        <tbody>
{% for i in competition.maxplayers|as_range %}
{% resolve box_config.entrants i as entrant %}
          <tr data-id="{{ entrant.id }}">
            <th>{% if user.is_authenticated %}<a href="{% url 'member_list' %}?filter-ids={{ entrant.player1.id }}">{% endif %}{{ entrant.player1.user.get_full_name }}{% if user.is_authenticated %}</a>{% endif %}</th>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
	    <td class="points"></td>
            <td class="points score_total"> </td>
          </tr>
{% endfor %}
        </tbody>
        </table>
        

      </div>
    </div>
{% if box_config.colspec != 'double' or box_config.nthcol != 'first' %}
  </div>
{% endif %}
{% endfor %}
  </div>
{% endblock %}{% comment "centered_page_content" %}{% endcomment %}

{% block extra_page_content %}
{{ block.super }}
<div data-role="popup" id="score_entry_dialog" data-overlay-theme="b" data-theme="a" data-dismissible="true">
  <div data-role="header">
    <h2>Match Result</h2>
    <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
  </div>
  <div class="ui-content">

{% include "match_result_form.html" %}

  </div>
</div>

<div data-role="popup" id="box_results_dialog" data-overlay-theme="b" data-theme="a" data-dismissible="true">
  <div data-role="header">
    <h2>Results</h2>
    <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
  </div>
  <div class="ui-content">
    <table class="league-results">
      <thead>
        <tr><th>Date</th><th>Opponents</th><th>Scores</th><th>Points</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>Wed 24th Feb, 7:56pm</td>
          <td><span class="winner">Stewart Perry</span> vs. Peter Richardson</td>
          <td class="points">9-3, 9-1, 9-0</td>
          <td class="points">7-2</td>
        </tr>
        <tr>
          <td>Wed 24th Feb, 7:56pm</td>
          <td><span class="winner">John Hughes</span> vs. Peter Richardson</td>
          <td class="points">9-3, 9-7, 8-9, 9-3</td>
          <td class="points">6-3</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

{% endblock %}{% comment "extra_page_content" %}{% endcomment %}
