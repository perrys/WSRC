{% extends "06_wsrc_navigation.html" %}

{% block titleprefix %}{{ competition.name }} {{ competition.end_date|date:'Y' }} - {% endblock %}
{% block pagetitle %}{{ competition.name }} Tournament {{ competition.end_date|date:'Y' }}{% endblock %}
{% block pagetype %}tournament{% endblock %}
{% block pageattrs %}data-competitionid="{{ competition.id }}"{% endblock %}
{% load competitions_extras %}
{% block html_header_extra %}
{{ block.super }}
<script>
window.WSRC_bracket_data = {{ bracket_data|safe }};
</script>
{% endblock %}


{% block centered_page_content %}

  <form id="page-control-form" method="GET" action="#" onsubmit="return false;" >  
    <div class="left-control-box">
      <select name="tournament_year_and_name" onchange="WSRC.onTournamentSelected(this)">
        <option value="">Select Tournament . . .</option>
{% for yearly_tournaments in tournaments|dictsortreversed:'year' %}
        <optgroup label="{{ yearly_tournaments.year }}">
{% for tournament in yearly_tournaments.competitions %}
          <option value="{% url 'tournaments' %}/{{ yearly_tournaments.year }}/{{ tournament.name|escape_url }}">{{ tournament.name }}</option>
{% endfor %}
        </optgroup>
{% endfor %}
      </select>
    </div>
    <div class="right-control-box">
      <fieldset data-role="controlgroup" data-type="horizontal" data-shadow="true">
        <button id="edit-button" data-inline="true" class="ui-btn ui-icon-edit ui-btn-icon-right {% if not user.is_authenticated or not user.player %}ui-state-disabled{% endif %}" {% if user.is_authenticated and user.player %}onclick="wsrc.Tournament.on_edit_clicked(this);"{% endif %}>Edit</button>
      </fieldset>
      <fieldset data-role="controlgroup" data-type="horizontal" data-shadow="true">
        <button id="bracket-refresh-button" data-inline="true" class="ui-btn ui-icon-refresh ui-btn-icon-right">Refresh</button>
      </fieldset>
    </div>
    <div class="clear-all"></div>
  </form>

  <div class="competition-wrapper">
  {{ bracket|safe }}
  </div>
{% endblock %}{% comment "centered_page_content" %}{% endcomment %}


{% block extra_page_content %}
{{ block.super }}
<div data-role="popup" id="score_entry_dialog" data-overlay-theme="b" data-theme="a" data-dismissible="true">
  <div data-role="header" data-theme="a">
    <h2>Match Result</h2>
    <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
  </div>
  <div class="ui-content">

{% include "match_result_form.html" %}

  </div>
</div>
{% endblock %}{% comment "extra_page_content" %}{% endcomment %}
