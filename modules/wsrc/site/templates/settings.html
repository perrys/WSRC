{% extends "06_wsrc_navigation.html" %}
{% block pagetitle %}Settings{% endblock %}
{% load kwacros %}
{% loadkwacros 'form_macros.html' %}
{% block centered_page_content %}

<form id="settings_form" method="post" action="{% url 'settings' %}" data-ajax="false" class="settings-form">
{% csrf_token %}

{% if form_saved %}
<span class="form_success_message">Settings saved.</span>
{% endif %}

{% if user_form.errors or player_form.errors or notify_formset.total_error_count %}

<span class="form_error_message ui-btn-icon ui-btn-icon-left ui-icon-alert">Validation Error. Please correct the problem(s) below and resubmit.</span>

{% for err in user_form.non_field_errors %}
  <div class="form_error_message">{{ err }}</div>
{% endfor %}

{% for err in player_form.non_field_errors %}
  <div class="form_error_message">{{ err }}</div>
{% endfor %}


{% endif %}

<input type="hidden" name="next" value="{% url 'settings' %}" />
<fieldset name="login_details">
<legend>Login</legend>
{% usekwacro createfield user_form.username %}
<div class="ui-field-contain">
 <label>Password:</label>
 <label class="ui-btn-c"><input id="id_password" type="checkbox" checked="checked" onclick="document.location='{% url 'password_change' %}'; this.checked=true; return false;"> Set (click to change)</label>
</div>
</fieldset>

<fieldset name="personal_details">
<legend>Personal Details</legend>
{% usekwacro createfield user_form.first_name %}
{% usekwacro createfield user_form.last_name %}
{% usekwacro createfield player_form.short_name %}
</fieldset>

<fieldset name="contact_details">
<legend>Contact Details</legend>
{% usekwacro createfield user_form.email %}
{% usekwacro createfield player_form.cell_phone %}
{% usekwacro createfield player_form.other_phone %}
{% usekwacro createfield player_form.prefs_receive_email %}
</fieldset>

<fieldset name="court_booking" class="toggle-root" >
<legend>Court Booking</legend>
<div class="ui-field-contain">
  <label for="notifier_active">Cancellations:</label>
  <span class="label">You have {{ n_notifiers }} notifier{{ n_notifiers|pluralize }} set up.</span>
  <button class="ui-btn ui-btn-inline ui-corner-all" id="add-notifier-button">Add</button>
  <button class="ui-btn ui-btn-inline ui-corner-all" id="remove-notifier-button">Remove</button>
</div>

{% if notify_formset.total_error_count > 0 %}
<!-- {{ notify_formset.errors }} -->
{% endif %}

{{ notify_formset.management_form }}
{% for form in notify_formset %}
<div class="notifier_fieldset toggle-root {% if forloop.counter > n_notifiers and form.errors|length == 0 %}toggled{% else %}togglable{% endif %}">
 <h4>Notifier {{ forloop.counter }}</h4>

{% for err in form.non_field_errors %}
  <div class="form_error_message">{{ err }}</div>
{% endfor %}

 {{ form.id }}
 {% usekwacro createfield form.earliest %}
 {% usekwacro createfield form.latest %}
 {% usekwacro createradiofield form.days %}
 {% usekwacro createfield form.notice_period_minutes %}
 <input id="{{ form.DELETE.id_for_label }}" name="{{ form.DELETE.html_name }}" type="hidden" class="delete"></input>
 {{ form.player }}
</div>
{% endfor %}

</fieldset>

<fieldset name="information">
<legend>Information</legend>
{% usekwacro createfield info_form.membership_type %}
{% usekwacro createfield info_form.wsrc_id %}
{% usekwacro createfield info_form.booking_system_id %}
{% usekwacro createfield info_form.cardnumber %}
{% usekwacro createfield info_form.squashlevels_id %}
</fieldset>

<input id="submit_button" type="submit" value="Update" data-theme="b" />

</form>

<script>
  wsrc.settings.onReady()
</script>

{% endblock %}
